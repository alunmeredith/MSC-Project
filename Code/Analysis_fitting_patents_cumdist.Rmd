---
title: "Curve Fitting Plot1 inset"
output:
  pdf_document: default
  html_notebook: default
---
```{r load data}
library(ggplot2)
library(gridExtra)
load("year_counts.RData")
```

As we saw in the reproducing valverde notebook the valverde suggests that the cumluative number of patents is a power law N(t) ~ t^theta. From our fit and including more modern data we can see that this fit doesn't seem appropriate. In this script we look at alternative distributions and see which best explains the distribution. 

```{r plot1_inset, fig.height=4, fig.width=11}
gg1b <- ggplot(data = year_counts, aes(x = rel_year, y = cum_count)) + 
    geom_point() +
    theme_bw() +
    labs(x = "t", y = "N(t)")

grid.arrange(gg1b, gg1b + scale_x_log10() + scale_y_log10(), ncol=2)
```

```{r, warning=FALSE}
attach(year_counts, warn.conflicts = FALSE)
exp.model <- lm(log(count) ~ rel_year)
summary(exp.model)

pl.model <- lm(log(count) ~ log(rel_year))
summary(pl.model)
```
By fitting an exponential model we can see a much better fit, with lower p values and higher adjusted R squared. 

```{r, fig.height=4, fig.width=11}
exp.pred <- exp(predict(exp.model, interval = "confidence", level = 0.95))
pl.pred <- exp(predict(pl.model, newdata = data.frame(rel_year = 1:40), interval = "confidence", level = 0.95))

gg1 <- ggplot(data = year_counts, aes(x = rel_year, y = count)) + 
    geom_point() + 
    geom_line(aes(y = exp.pred[,"fit"])) +
    geom_ribbon(aes(ymax = exp.pred[,"upr"], ymin = exp.pred[,"lwr"]), alpha = 0.3) +
    theme_bw() + 
    geom_line(aes(y = pl.pred[,"fit"], x = 1:40), linetype = "dashed")

gg <- ggplot(data = year_counts, aes(x = rel_year, y = cum_count)) +
    geom_point() +
    geom_line(aes(y = cumsum(exp.pred[,"fit"]))) +
    geom_ribbon(aes(ymax = cumsum(exp.pred[,"upr"]), ymin = cumsum(exp.pred[,"lwr"])), alpha = 0.3) +
    theme_bw() +
    geom_line(aes(y = cumsum(pl.pred[,"fit"])), linetype = "dashed")

grid.arrange(gg1, gg, gg + scale_x_log10() + scale_y_log10(), ncol = 3)
```

# Questions
 - Should I try to fit other distributions
 - Is this enough analysis of this or should I do something more thorough? What would I do?
 - Plots In report should I have plots like this? If so I will make them 
```{r save}
png("Figures/patentCountFit.png"); gg1; dev.off()
png("Figures/patentCountFit_cum.png"); gg; dev.off()
png("Figures/patentCountFit_cum_loglog.png"); gg + scale_x_log10() + scale_y_log10(); dev.off()
```

